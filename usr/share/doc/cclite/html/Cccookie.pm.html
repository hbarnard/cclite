<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Cccookie.pm</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:root@localhost" />
</head>

<style type="text/css">
<!--
/* default style sheet generated by perltidy */
body {background: #FFFFFF; color: #000000}
pre { color: #000000; 
      background: #F0F0F0;
      font-family: courier;
    } 

.c  { color: #228B22;} /* comment */
.cm { color: #000000;} /* comma */
.co { color: #000000;} /* colon */
.h  { color: #CD5555; font-weight:bold;} /* here-doc-target */
.hh { color: #CD5555; font-style:italic;} /* here-doc-text */
.i  { color: #00688B;} /* identifier */
.j  { color: #CD5555; font-weight:bold;} /* label */
.k  { color: #8B008B; font-weight:bold;} /* keyword */
.m  { color: #FF0000; font-weight:bold;} /* subroutine */
.n  { color: #B452CD;} /* numeric */
.p  { color: #000000;} /* paren */
.pd { color: #228B22; font-style:italic;} /* pod-text */
.pu { color: #000000;} /* punctuation */
.q  { color: #CD5555;} /* quote */
.s  { color: #000000;} /* structure */
.sc { color: #000000;} /* semicolon */
.v  { color: #B452CD;} /* v-string */
.w  { color: #000000;} /* bareword */
-->
</style>
<body style="background-color: white">
<a name="-top-"></a>
<h1>Cccookie.pm</h1>


<!-- INDEX BEGIN -->
<div name="index">
<p><a name="__index__"></a></p>

<ul>

	<li><a href="#name">NAME</a></li>
	<li><a href="#synopsis">SYNOPSIS</a></li>
	<li><a href="#description">DESCRIPTION</a></li>
	<li><a href="#author">AUTHOR</a></li>
	<li><a href="#see_also">SEE ALSO</a></li>
	<li><a href="#copyright">COPYRIGHT</a></li>
	<ul>

		<ul>

			<li><a href="#get_cookie">get_cookie</a></li>
			<li><a href="#return_cookie_header">return_cookie_header</a></li>
			<li><a href="#delete_cookies">delete_cookies</a></li>
			<li><a href="#split_cookie">split_cookie</a></li>
		</ul>

	</ul>

</ul>

<hr name="index" />
</div>
<!-- INDEX END -->
<h2>Code Index:</h2>
<!-- BEGIN CODE INDEX --><a name="code-index"></a>
<ul>
<li><a href="#package-Cccookie-">package Cccookie</a>
<ul>
<li><a href="#get_cookie-">get_cookie</a></li>
<li><a href="#return_cookie_header-">return_cookie_header</a></li>
<li><a href="#delete_cookies-">delete_cookies</a></li>
<li><a href="#split_cookie-">split_cookie</a></li>
</ul>
</li>
<li><a href="#EOF-">EOF</a></li>
</ul>
<!-- END CODE INDEX -->

<p>
</p>
<h1><a name="name">NAME</a></h1>
<p>Cccookie.pm</p>
<p>
</p>
<hr />
<h1><a name="synopsis">SYNOPSIS</a></h1>
<p>Cookie handling functions</p>
<p>
</p>
<hr />
<h1><a name="description">DESCRIPTION</a></h1>
<p>$Id: Cccookie.pm,v 1.0 2004-07-23 09:40:25+01 hb48754 Exp hb48754 $</p>
<p>Copyright (c) 1998 Peter D. Kovacs  
Unpublished work.
Permission granted to use and modify this library so long as the
copyright above is maintained, modifications are documented, and
credit is given for any use of the library.</p>
<p>Portions of this library are taken, without permission (and much 
appreciated), from the cgi-lib.pl.  You may get that at 
<a href="http://cgi-lib.stanford.edu/cgi-lib">http://cgi-lib.stanford.edu/cgi-lib</a></p>
<p>-$cookie{MyCookie} = &quot;MyValue&quot;;
-set_cookie($expiration, $domain, $path, $secure,%cookies);
-get_cookie();
-delete_cookies($expiration, $domain, $path, $secure,%cookies);
-split_cookie</p>
<pre>

turned into a cookie module from its original form by Hugh Barnard
Copyright (c) 2004 Hugh B Barnard  
Unpublished work.</pre>
<p>
</p>
<hr />
<h1><a name="author">AUTHOR</a></h1>
<p>Peter Kovacs
Hugh Barnard</p>
<p>
</p>
<hr />
<h1><a name="see_also">SEE ALSO</a></h1>
<p><a href="http://cgi-lib.stanford.edu/cgi-lib">http://cgi-lib.stanford.edu/cgi-lib</a></p>
<p>
</p>
<hr />
<h1><a name="copyright">COPYRIGHT</a></h1>
<p>(c) 1998 Peter D. Kovacs</p>
<pre>
<a name="package-Cccookie-"></a><span class="k">package </span><span class="i">Cccookie</span><span class="sc">;</span>

<span class="k">use</span> <span class="w">strict</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">vars</span> <span class="q">qw(@ISA @EXPORT)</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">Exporter</span><span class="sc">;</span>

<span class="k">my</span> <span class="i">$VERSION</span> = <span class="n">1.00</span><span class="sc">;</span>
<span class="i">@ISA</span>    = <span class="q">qw(Exporter)</span><span class="sc">;</span>
<span class="i">@EXPORT</span> = <span class="q">qw(return_cookie_header delete_cookies get_cookie split_cookie)</span><span class="sc">;</span>

</pre><p></p>
<h3><a name="get_cookie">get_cookie</a></h3>
<p>Get a cookie. This returns a reference to a hash nowadays</p>
<pre>
<a name="get_cookie-"></a><span class="k">sub </span><span class="m">get_cookie</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">$chip</span><span class="cm">,</span> <span class="i">$val</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%cookie</span><span class="sc">;</span>
    <span class="k">foreach</span> <span class="s">(</span> <span class="k">split</span><span class="s">(</span> <span class="q">/; /</span><span class="cm">,</span> <span class="i">$ENV</span>{<span class="q">&#39;HTTP_COOKIE&#39;</span>} <span class="s">)</span> <span class="s">)</span> <span class="s">{</span>

   <span class="c"># split cookie at each ; (cookie format is name=value; name=value; etc...)</span>
   <span class="c"># Convert plus to space (in case of encoding (not necessary, but recommended)</span>
        <span class="q">s/\+/ /g</span><span class="sc">;</span>

        <span class="c"># Split into key and value.</span>
        <span class="s">(</span> <span class="i">$chip</span><span class="cm">,</span> <span class="i">$val</span> <span class="s">)</span> = <span class="k">split</span><span class="s">(</span> <span class="q">/=/</span><span class="cm">,</span> <span class="i">$_</span><span class="cm">,</span> <span class="n">2</span> <span class="s">)</span><span class="sc">;</span>    <span class="c"># splits on the first =.</span>
                <span class="c"># Convert %XX from hex numbers to alphanumeric</span>
        <span class="i">$chip</span> =~ <span class="q">s/%([A-Fa-f0-9]{2})/pack(&quot;c&quot;,hex($1))/ge</span><span class="sc">;</span>
        <span class="i">$val</span>  =~ <span class="q">s/%([A-Fa-f0-9]{2})/pack(&quot;c&quot;,hex($1))/ge</span><span class="sc">;</span>

        <span class="c"># Associate key and value</span>
        <span class="i">$cookie</span>{<span class="i">$chip</span>} .= <span class="q">&quot;\1&quot;</span>
          <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span><span class="s">(</span> <span class="i">$cookie</span>{<span class="i">$chip</span>} <span class="s">)</span> <span class="s">)</span><span class="sc">;</span>    <span class="c"># \1 is the multiple separator</span>
        <span class="i">$cookie</span>{<span class="i">$chip</span>} .= <span class="i">$val</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">return</span> \<span class="i">%cookie</span><span class="sc">;</span>
<span class="s">}</span>

</pre><p></p>
<h3><a name="return_cookie_header">return_cookie_header</a></h3>
<p>Make and return an http cookie header
Set-cookie etc.</p>
<pre>
<a name="return_cookie_header-"></a><span class="k">sub </span><span class="m">return_cookie_header</span> <span class="s">{</span>

<span class="c"># $expires must be in unix time format, if defined.  If not defined the cookie should expire at end of session</span>
<span class="c"># If you want no expiration date set, set $expires = -1 (this causes the cookie to be deleted when user closes</span>
<span class="c"># his/her browser).</span>

    <span class="k">my</span> <span class="s">(</span> <span class="i">$expires</span><span class="cm">,</span> <span class="i">$domain</span><span class="cm">,</span> <span class="i">$path</span><span class="cm">,</span> <span class="i">$sec</span><span class="cm">,</span> <span class="i">%cookie</span> <span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$secure</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">@days</span><span class="s">)</span> = <span class="s">(</span> <span class="q">&quot;Sun&quot;</span><span class="cm">,</span> <span class="q">&quot;Mon&quot;</span><span class="cm">,</span> <span class="q">&quot;Tue&quot;</span><span class="cm">,</span> <span class="q">&quot;Wed&quot;</span><span class="cm">,</span> <span class="q">&quot;Thu&quot;</span><span class="cm">,</span> <span class="q">&quot;Fri&quot;</span><span class="cm">,</span> <span class="q">&quot;Sat&quot;</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">@months</span><span class="s">)</span> = <span class="s">(</span>
        <span class="q">&quot;Jan&quot;</span><span class="cm">,</span> <span class="q">&quot;Feb&quot;</span><span class="cm">,</span> <span class="q">&quot;Mar&quot;</span><span class="cm">,</span> <span class="q">&quot;Apr&quot;</span><span class="cm">,</span> <span class="q">&quot;May&quot;</span><span class="cm">,</span> <span class="q">&quot;Jun&quot;</span><span class="cm">,</span>
        <span class="q">&quot;Jul&quot;</span><span class="cm">,</span> <span class="q">&quot;Aug&quot;</span><span class="cm">,</span> <span class="q">&quot;Sep&quot;</span><span class="cm">,</span> <span class="q">&quot;Oct&quot;</span><span class="cm">,</span> <span class="q">&quot;Nov&quot;</span><span class="cm">,</span> <span class="q">&quot;Dec&quot;</span>
    <span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="s">(</span> <span class="i">$seconds</span><span class="cm">,</span> <span class="i">$min</span><span class="cm">,</span> <span class="i">$hour</span><span class="cm">,</span> <span class="i">$mday</span><span class="cm">,</span> <span class="i">$mon</span><span class="cm">,</span> <span class="i">$year</span><span class="cm">,</span> <span class="i">$wday</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$expires</span> &gt; <span class="n">0</span> <span class="s">)</span> <span class="s">{</span>    <span class="c">#get date info if expiration set.</span>
        <span class="s">(</span> <span class="i">$seconds</span><span class="cm">,</span> <span class="i">$min</span><span class="cm">,</span> <span class="i">$hour</span><span class="cm">,</span> <span class="i">$mday</span><span class="cm">,</span> <span class="i">$mon</span><span class="cm">,</span> <span class="i">$year</span><span class="cm">,</span> <span class="i">$wday</span> <span class="s">)</span> = <span class="k">gmtime</span><span class="s">(</span><span class="i">$expires</span><span class="s">)</span><span class="sc">;</span>

        <span class="c"># expiry date format: Wdy, DD-Mon-YYYY HH:MM:SS GMT</span>

        <span class="q">&quot;0&quot;</span> . <span class="i">$seconds</span> <span class="k">if</span> <span class="s">(</span> <span class="i">$seconds</span> &lt; <span class="n">10</span> <span class="s">)</span><span class="sc">;</span>    <span class="c"># formatting of date variables</span>
        <span class="q">&quot;0&quot;</span> . <span class="i">$min</span>     <span class="k">if</span> <span class="s">(</span> <span class="i">$min</span> &lt; <span class="n">10</span> <span class="s">)</span><span class="sc">;</span>
        <span class="q">&quot;0&quot;</span> . <span class="i">$hour</span>    <span class="k">if</span> <span class="s">(</span> <span class="i">$hour</span> &lt; <span class="n">10</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">my</span> <span class="s">(</span><span class="i">@secure</span><span class="s">)</span> = <span class="s">(</span> <span class="q">&quot;&quot;</span><span class="cm">,</span> <span class="q">&quot;secure&quot;</span> <span class="s">)</span>
      <span class="sc">;</span> <span class="c"># add security to the cookie if defined.  I&#39;m not too sure how this works.</span>

    <span class="k">if</span> <span class="s">(</span> !<span class="k">length</span><span class="s">(</span><span class="i">$expires</span><span class="s">)</span> <span class="s">)</span> <span class="s">{</span>

        <span class="c"># was $expires = &quot; expires\=Wed, 31-Dec-2004 00:00:00 GMT;&quot;</span>
        <span class="i">$expires</span> = <span class="q">&quot;Thu, 01-Jan-1970 00:00:00 GMT;&quot;</span><span class="sc">;</span>
    <span class="s">}</span>    <span class="c"># if expiration not set, expire at</span>
    <span class="k">elsif</span> <span class="s">(</span> <span class="i">$expires</span> == <span class="n">-1</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$expires</span> = <span class="q">&quot;Thu, 01-Jan-1970 00:00:00 GMT;&quot;</span><span class="sc">;</span>
    <span class="s">}</span>    <span class="c"># if expiration set to -1, then eliminate expiration of cookie.</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="i">$year</span> += <span class="n">1900</span><span class="sc">;</span>
        <span class="i">$expires</span> =
<span class="q">&quot;expires\=$days[$wday], $mday-$months[$mon]-$year $hour:$min:$seconds GMT; &quot;</span>
          <span class="sc">;</span>    <span class="c">#form expiration from value passed to function.</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> !<span class="k">defined</span> <span class="i">$domain</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$domain</span> = <span class="i">$ENV</span>{<span class="q">&#39;SERVER_NAME&#39;</span>}<span class="sc">;</span>
    <span class="s">}</span>    <span class="c">#set domain of cookie.  Default is current host.</span>
    <span class="k">if</span> <span class="s">(</span> !<span class="k">defined</span> <span class="i">$path</span> <span class="s">)</span> <span class="s">{</span> <span class="i">$path</span> = <span class="q">&quot;/&quot;</span><span class="sc">;</span> <span class="s">}</span>    <span class="c">#set default path = &quot;/&quot;</span>
           <span class="c">#if ( !defined $secure ) { $secure = &quot;0&quot;; }</span>

    <span class="k">my</span> <span class="i">$header</span><span class="sc">;</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$key</span> <span class="s">(</span> <span class="k">keys</span> <span class="i">%cookie</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$cookie</span>{<span class="i">$key</span>} =~ <span class="q">s/ /+/g</span>
          <span class="k">if</span> <span class="s">(</span> <span class="k">length</span><span class="s">(</span> <span class="i">$cookie</span>{<span class="i">$key</span>} <span class="s">)</span> <span class="s">)</span><span class="sc">;</span>    <span class="c">#convert space to plus.</span>
        <span class="i">$header</span> .=
<span class="q">&quot;Set-Cookie: $key\=$cookie{$key}; $expires path\=$path; domain\=$domain; $secure[$sec]\n&quot;</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">return</span> <span class="i">$header</span><span class="sc">;</span>
<span class="s">}</span>

</pre><p></p>
<h3><a name="delete_cookies">delete_cookies</a></h3>
<p>Delete named cookies</p>
<pre>
<a name="delete_cookies-"></a><span class="k">sub </span><span class="m">delete_cookies</span> <span class="s">{</span>

<span class="c"># to delete a cookie, simply pass delete_cookie the name of the cookie to delete.</span>
<span class="c"># you may pass delete_cookie more than 1 name at a time.</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">$expires</span><span class="cm">,</span> <span class="i">$domain</span><span class="cm">,</span> <span class="i">$path</span><span class="cm">,</span> <span class="i">$sec</span><span class="cm">,</span> <span class="i">%cookie</span> <span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$header</span><span class="sc">;</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$key</span> <span class="s">(</span> <span class="k">keys</span> <span class="i">%cookie</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">undef</span> <span class="i">$cookie</span>{<span class="i">$key</span>
          }<span class="sc">;</span> <span class="c">#undefines cookie so if you call set_cookie, it doesn&#39;t reset the cookie.</span>
        <span class="i">$header</span> .=
          <span class="q">&quot;Set-Cookie: $key=deleted; expires=Thu, 01-Jan-1970 00:00:00 GMT;\n&quot;</span><span class="sc">;</span>

        <span class="c">#this also must be done before you print any content type headers.</span>
    <span class="s">}</span>
    <span class="k">return</span> <span class="i">$header</span><span class="sc">;</span>
<span class="s">}</span>

</pre><p></p>
<h3><a name="split_cookie">split_cookie</a></h3>
<p>Split multivalued cookies into their component parts</p>

<pre>
<a name="split_cookie-"></a><span class="k">sub </span><span class="m">split_cookie</span> <span class="s">{</span>

    <span class="c"># split_cookie</span>
    <span class="c"># Splits a multi-valued parameter into a list of the constituent parameters</span>

    <span class="k">my</span> <span class="s">(</span><span class="i">$param</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">@params</span><span class="s">)</span> = <span class="k">split</span><span class="s">(</span> <span class="q">&quot;\1&quot;</span><span class="cm">,</span> <span class="i">$param</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">return</span> <span class="s">(</span> <span class="k">wantarray</span> ? <span class="i">@params</span> <span class="co">:</span> <span class="i">$params</span>[<span class="n">0</span>] <span class="s">)</span><span class="sc">;</span>
<span class="s">}</span>

<span class="n">1</span><span class="sc">;</span>

<a name="EOF-"></a></pre></body>

</html>
