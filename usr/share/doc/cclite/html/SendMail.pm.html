<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>SendMail.pm</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:root@localhost" />
</head>

<style type="text/css">
<!--
/* default style sheet generated by perltidy */
body {background: #FFFFFF; color: #000000}
pre { color: #000000; 
      background: #F0F0F0;
      font-family: courier;
    } 

.c  { color: #228B22;} /* comment */
.cm { color: #000000;} /* comma */
.co { color: #000000;} /* colon */
.h  { color: #CD5555; font-weight:bold;} /* here-doc-target */
.hh { color: #CD5555; font-style:italic;} /* here-doc-text */
.i  { color: #00688B;} /* identifier */
.j  { color: #CD5555; font-weight:bold;} /* label */
.k  { color: #8B008B; font-weight:bold;} /* keyword */
.m  { color: #FF0000; font-weight:bold;} /* subroutine */
.n  { color: #B452CD;} /* numeric */
.p  { color: #000000;} /* paren */
.pd { color: #228B22; font-style:italic;} /* pod-text */
.pu { color: #000000;} /* punctuation */
.q  { color: #CD5555;} /* quote */
.s  { color: #000000;} /* structure */
.sc { color: #000000;} /* semicolon */
.v  { color: #B452CD;} /* v-string */
.w  { color: #000000;} /* bareword */
-->
</style>
<body style="background-color: white">
<a name="-top-"></a>
<h1>SendMail.pm</h1>


<!-- INDEX BEGIN -->
<div name="index">
<p><a name="__index__"></a></p>

<ul>

	<li><a href="#name">NAME</a></li>
	<li><a href="#synopsis">SYNOPSIS</a></li>
	<li><a href="#example">EXAMPLE</a></li>
	<li><a href="#description">DESCRIPTION</a></li>
	<li><a href="#changes">CHANGES</a></li>
	<li><a href="#credits">CREDITS</a></li>
	<li><a href="#source">SOURCE</a></li>
	<li><a href="#author">AUTHOR</a></li>
	<li><a href="#version">VERSION</a></li>
	<li><a href="#see_also">SEE ALSO</a></li>
</ul>

<hr name="index" />
</div>
<!-- INDEX END -->
<h2>Code Index:</h2>
<!-- BEGIN CODE INDEX --><a name="code-index"></a>
<ul>
<li><a href="#package-SendMail-">package SendMail</a>
<ul>
<li><a href="#new-">new</a></li>
<li><a href="#Attach-">Attach</a></li>
<li><a href="#Bcc-">Bcc</a></li>
<li><a href="#Cc-">Cc</a></li>
<li><a href="#ErrorsTo-">ErrorsTo</a></li>
<li><a href="#From-">From</a></li>
<li><a href="#Inline-">Inline</a></li>
<li><a href="#OFF-">OFF</a></li>
<li><a href="#ON-">ON</a></li>
<li><a href="#AUTHLOGIN-">AUTHLOGIN</a></li>
<li><a href="#AUTHPLAIN-">AUTHPLAIN</a></li>
<li><a href="#ReplyTo-">ReplyTo</a></li>
<li><a href="#Subject-">Subject</a></li>
<li><a href="#To-">To</a></li>
<li><a href="#attach-1-">attach</a></li>
<li><a href="#clearAttach-">clearAttach</a></li>
<li><a href="#clearBcc-">clearBcc</a></li>
<li><a href="#clearCc-">clearCc</a></li>
<li><a href="#clearTo-">clearTo</a></li>
<li><a href="#createMailData-">createMailData</a></li>
<li><a href="#getEmailAddress-">getEmailAddress</a></li>
<li><a href="#getMIMEType-">getMIMEType</a></li>
<li><a href="#getRcptLists-">getRcptLists</a></li>
<li><a href="#isMailReady-">isMailReady</a></li>
<li><a href="#receiveFromServer-">receiveFromServer</a></li>
<li><a href="#reset-">reset</a></li>
<li><a href="#sendMail-">sendMail</a></li>
<li><a href="#setAuth-">setAuth</a></li>
<li><a href="#sendToServer-">sendToServer</a></li>
<li><a href="#setDebug-">setDebug</a></li>
<li><a href="#setError-">setError</a></li>
<li><a href="#setMailBody-">setMailBody</a></li>
<li><a href="#setMailHeader-">setMailHeader</a></li>
<li><a href="#setSMTPPort-">setSMTPPort</a></li>
<li><a href="#setSMTPServer-">setSMTPServer</a></li>
<li><a href="#version-">version</a></li>
</ul>
</li>
<li><a href="#__END__-">__END__</a></li>
<li><a href="#EOF-">EOF</a></li>
</ul>
<!-- END CODE INDEX -->

<p></p>
<hr />
<h1><a name="name">NAME</a></h1>
<p>SendMail -- This is a perl module which is using Socket to connect the SMTP port to send mails.</p>
<p>
</p>
<hr />
<h1><a name="synopsis">SYNOPSIS</a></h1>
<pre>
  use SendMail;</pre>
<pre>
  $smtpserver           = &quot;mail.server.com&quot;;
  $smtpport             = 25;
  $userid               = &quot;authuserid&quot;;
  $password             = &quot;authpassword&quot;;
  $sender               = &quot;Sender &lt;sender@domain.com&gt;&quot;;
  $subject              = &quot;Subject of the mail.&quot;;
  $recipient            = &quot;Recipient &lt;recipient@domain.com&gt;&quot;;
  $recipient2           = &quot;Recipient 2 &lt;recipient2@domain.com&gt;&quot;;
  @recipients           = ($recipient, $recipient2);
  $administrator        = &quot;Administrator &lt;admin@domain.com&gt;&quot;;
  $administrator2       = &quot;Administrator 2 &lt;admin2@domain.com&gt;&quot;;
  $replyto              = $sender;
  $replyto2             = $recipient;
  @replytos             = ($replyto, $replyto2);
  $header               = &quot;X-Mailer&quot;;
  $headervalue          = &quot;Perl SendMail Module 2.09&quot;;
  $mailbodydata         = &quot;This is a testing mail.&quot;;</pre>
<pre>
  $obj = new SendMail();
  $obj = new SendMail($smtpserver);
  $obj = new SendMail($smtpserver, $smtpport);</pre>
<pre>
  $obj-&gt;setDebug($obj-&gt;ON);
  $obj-&gt;setDebug($obj-&gt;OFF);</pre>
<pre>
  $obj-&gt;setAuth($obj-&gt;AUTHLOGIN, $userid, $password);
  $obj-&gt;setAuth($obj-&gt;AUTHPLAIN, $userid, $password);</pre>
<pre>
  $obj-&gt;From($sender);</pre>
<pre>
  $obj-&gt;Subject($subject);</pre>
<pre>
  $obj-&gt;To($recipient);
  $obj-&gt;To($recipient, $recipient2);
  $obj-&gt;To(@recipients);</pre>
<pre>
  $obj-&gt;Cc($recipient);
  $obj-&gt;Cc($recipient, $recipient2);
  $obj-&gt;Cc(@recipients);</pre>
<pre>
  $obj-&gt;Bcc($recipient);
  $obj-&gt;Bcc($recipient, $recipient2);
  $obj-&gt;Bcc(@recipients);</pre>
<pre>
  $obj-&gt;ErrorsTo($administrator);
  $obj-&gt;ErrorsTo($administrator, $administrator2);
  $obj-&gt;ErrorsTo(@administrators);</pre>
<pre>
  $obj-&gt;ReplyTo($replyto);
  $obj-&gt;ReplyTo($replyto, $replyto2);
  $obj-&gt;ReplyTo(@replytos);</pre>
<pre>
  $obj-&gt;setMailHeader($header, $headervalue);</pre>
<pre>
  $obj-&gt;setMailBody($mailbodydata);</pre>
<pre>
  $obj-&gt;Attach($file);
  $obj-&gt;Attach($file, \$filedata);
  $obj-&gt;Attach($file, \*FILEHANDLE);
  $obj-&gt;Attach($file, new IO::File(&quot;filename&quot;, &quot;r&quot;));</pre>
<pre>
  $obj-&gt;Inline($file);
  $obj-&gt;Inline($file, \$filedata);
  $obj-&gt;Inline($file, \*FILEHANDLE);
  $obj-&gt;Inline($file, new IO::File(&quot;filename&quot;, &quot;r&quot;));</pre>
<pre>
  if ($obj-&gt;sendMail() != 0) {
    print $obj-&gt;{'error'}.&quot;\n&quot;;
  }</pre>
<pre>
  $obj-&gt;clearTo();
  $obj-&gt;clearBcc();
  $obj-&gt;clearCc();
  $obj-&gt;clearAttach();</pre>
<pre>
  $obj-&gt;reset();</pre>
<p>
</p>
<hr />
<h1><a name="example">EXAMPLE</a></h1>
<p><a href="http://www.tneoh.zoneit.com/perl/SendMail/testSendMail.pl">http://www.tneoh.zoneit.com/perl/SendMail/testSendMail.pl</a></p>
<p>
</p>
<hr />
<h1><a name="description">DESCRIPTION</a></h1>
<p>This module is written so that user can easily use it to send mailing list. 
Please do not abuse it.</p>
<p>And it can be used in any perl script to send a mail similar to sending mail
by using /usr/lib/sendmail program.</p>
<p>I have tested this module on Unix and Windows platforms, it works fine. 
Of course you need perl version 5. With the example script, 
testSendMail.pl, you can simply a testing on it.</p>
<p>Errors, comments or questions are welcome.</p>
<p>
</p>
<hr />
<h1><a name="changes">CHANGES</a></h1>
<p>1.00-&gt;1.01 Recipients with email address contains a &quot;-&quot; in the hostname,
will be able to receive the email now.</p>
<p>1.01-&gt;1.02 Module now not only expecting one line reply from the server, it
can receive multiple lines until the server waiting for next command.</p>
<p>1.02-&gt;1.03 Repeat declaration of &quot;$currEmail&quot; will give an error in NT
system.</p>
<p>1.03-&gt;1.04 Email addresses are enclosed in &lt; and &gt; after &quot;MAIL FROM&quot; and
&quot;RCPT TO&quot; commands.(<a href="http://www.ietf.org/rfc/rfc821.txt" class="rfc">RFC821</a>) For Microsoft Exchange 4, email addresses
not enclosed in &lt; and &gt; will get an error from the system.</p>
<p>1.04-&gt;1.05 <code>getEmailAddress()</code> subroutine should accept email address
in just <a href="mailto:"<user@domain.com>">"<user@domain.com></a>&quot; format.</p>
<p>1.05-&gt;2.00b Simple MIME supported. <code>attach()</code>, <code>Attach()</code> and <code>Inline()</code> 
subroutines added.</p>
<p>2.00b-&gt;2.00 <code>Attach()</code> and <code>Inline()</code> supports for filehandle which is
easier for users who are using CGI.pm. Prototypes are added. And we
send &quot;\r\n&quot; to the SMTP server instead of only &quot;\n&quot;.</p>
<p>2.00-&gt;2.01 After sending the maildata, supposed to be &quot;\r\n&quot; instead
of just &quot;\n&quot;.</p>
<p>2.01-&gt;2.02 Calling <code>eof()</code> to check the opened socket, else it will
cause an error in ActivePerl5.6.</p>
<p>2.02-&gt;2.03 Change all EOL to &quot;\r\n&quot;, instead of just &quot;\n&quot;.</p>
<p>2.03-&gt;2.04 Only Base64 encoding is being used, no more using Quoted
Print. And <code>import()</code> has been taken out for Sys::Hostname as it has
been deprecated. Giving more hints in &quot;no host&quot; error message.</p>
<p>2.04-&gt;2.05 <code>clearTo()</code>, <code>clearCc()</code> and <code>clearBcc()</code> are added to allow
clearing the recipient email addresses without reset the whole email
information, eg. body, subject and etc. Simple SMTP AUTH is supported.</p>
<p>2.05-&gt;2.06 Some values were not initialized.</p>
<p>2.06-&gt;2.07 The <code>clearXXX()</code> functions, eg. <code>clearTo()</code>, did not work well
when sending multiple emails. The list was not cleared properly. For
example, the To: field would be left with a 
<a href="mailto:"ARRAY@localhost.domain.com">"ARRAY@localhost.domain.com</a> (82477472),&quot; in it. <code>clearAttach()</code> is added.
And EHLO is used first to support SMTP AUTH, because some of the MTA is
looking for EHLO first.</p>
<p>2.07-&gt;2.08 Bare LF error occurred when no attachment.</p>
<p>2.08-&gt;2.09 Better fix for LF problem.</p>
<p>
</p>
<hr />
<h1><a name="credits">CREDITS</a></h1>
<p>laurens van alphen</p>
<p>Dag Øien</p>
<p>Juliano, Sylvia, CON, OASD(HA)/TMA</p>
<p>Tony Simopoulos</p>
<p>Jeff Graves</p>
<p>Pisciotta, Steve</p>
<p>Phill Crow</p>
<p>Mark Grennan</p>
<p>Bill Friend</p>
<p>
</p>
<hr />
<h1><a name="source">SOURCE</a></h1>
<p><a href="http://www.tneoh.zoneit.com/perl/SendMail/SendMail.pm">http://www.tneoh.zoneit.com/perl/SendMail/SendMail.pm</a></p>
<p>
</p>
<hr />
<h1><a name="author">AUTHOR</a></h1>
<p>Simon Tneoh Chee-Boon	<a href="mailto:tneohcb@pc.jaring.my">tneohcb@pc.jaring.my</a></p>
<p>Copyright (c) 1998-2003 Simon Tneoh Chee-Boon. All rights reserved.
This program is free software; you can redistribute it and/or
modify it under the same terms as Perl itself.</p>
<p>
</p>
<hr />
<h1><a name="version">VERSION</a></h1>
<p>Version 2.09 	04 March 2003</p>
<p>
</p>
<hr />
<h1><a name="see_also">SEE ALSO</a></h1>
<p>Socket.pm, MIME::Base64.pm, MIME::QuotedPrint.pm</p>

<hr /><pre><span class="c">#</span>
<span class="c"># This is the name of the current module.</span>
<span class="c">#</span>
<a name="package-SendMail-"></a><span class="k">package </span><span class="i">SendMail</span><span class="sc">;</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># Constructor:</span>
<span class="c">#	$obj = new SendMail;</span>
<span class="c">#       $obj = new SendMail($smtpserver);</span>
<span class="c">#       $obj = new SendMail($smtpserver, $smtpport);</span>
<span class="c">#</span>
<span class="c"># Methods:</span>
<span class="c">#	$obj-&gt;Attach($filename, [\$data]);</span>
<span class="c"># 	$obj-&gt;Bcc($bccemailadd1, [$bccemailadd2, ...]);</span>
<span class="c"># 	$obj-&gt;Cc($ccemailadd1, [$ccemailadd2, ...]);</span>
<span class="c"># 	$obj-&gt;ErrorsTo($errorstoadd1, [$errorstoadd2, ...]);</span>
<span class="c"># 	$obj-&gt;From($sender);</span>
<span class="c">#	$obj-&gt;Inline($filename, [\$data]);</span>
<span class="c">#	$obj-&gt;AUTHLOGIN;</span>
<span class="c">#	$obj-&gt;AUTHPLAIN;</span>
<span class="c"># 	$obj-&gt;OFF;</span>
<span class="c"># 	$obj-&gt;ON;</span>
<span class="c"># 	$obj-&gt;ReplyTo($replytoadd1, [$replytoadd2, ...]);</span>
<span class="c"># 	$obj-&gt;Subject($subject);</span>
<span class="c"># 	$obj-&gt;To($recipient1, [$recipient2, ...]);</span>
<span class="c">#	$obj-&gt;attach(\%hash);</span>
<span class="c">#	$obj-&gt;clearAttach();</span>
<span class="c">#	$obj-&gt;clearBcc();</span>
<span class="c">#	$obj-&gt;clearCc();</span>
<span class="c">#	$obj-&gt;clearTo();</span>
<span class="c"># 	$obj-&gt;createMailData();</span>
<span class="c"># 	$obj-&gt;getEmailAddress($emailaddstr);</span>
<span class="c"># 	$obj-&gt;getRcptLists();</span>
<span class="c"># 	$obj-&gt;isMailReady();</span>
<span class="c">#	$obj-&gt;receiveFromServer(\*SOCKET);</span>
<span class="c"># 	$obj-&gt;reset();</span>
<span class="c"># 	$obj-&gt;sendMail();</span>
<span class="c">#	$obj-&gt;sendToServer(\*SOCKET, $message);</span>
<span class="c">#	$obj-&gt;setAuth($authtype, $userid, $password);</span>
<span class="c"># 	$obj-&gt;setDebug($obj-&gt;ON);</span>
<span class="c"># 	$obj-&gt;setError($errormessage);</span>
<span class="c"># 	$obj-&gt;setMailBody($mailbody);</span>
<span class="c"># 	$obj-&gt;setMailHeader($mailheader, $mailheadervalue);</span>
<span class="c"># 	$obj-&gt;setSMTPPort($smtpport);</span>
<span class="c"># 	$obj-&gt;setSMTPServer($smtpserver);</span>
<span class="c"># 	$obj-&gt;version;</span>
<span class="c">#</span>
<span class="c"># *p/s: For more details, please refer to the description below.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>

<span class="c">#</span>
<span class="c"># We are using Socket.pm to connect to the SMTP port.</span>
<span class="c">#</span>
<span class="k">use</span> <span class="w">Socket</span><span class="sc">;</span>

<span class="c">#</span>
<span class="c"># We are using MIME::Base64 and MIME::QuotedPrint to encode MIME data.</span>
<span class="c">#</span>
<span class="k">use</span> <span class="w">MIME::Base64</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">MIME::QuotedPrint</span><span class="sc">;</span>

<span class="k">use</span> <span class="w">Exporter</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">strict</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">vars</span> <span class="q">qw($_LOCALHOST $VERSION $_MAILER @ISA @EXPORT @EXPORT_OK $_ERR)</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">vars</span> <span class="q">qw($_DEFAULT_SMTP_PORT)</span><span class="sc">;</span>
<span class="i">@EXPORT</span>    = <span class="q">qw()</span><span class="sc">;</span>
<span class="i">@EXPORT_OK</span> = <span class="q">qw()</span><span class="sc">;</span>

<span class="i">$VERSION</span>            = <span class="q">&quot;2.09&quot;</span><span class="sc">;</span>
<span class="i">$_MAILER</span>            = <span class="q">&quot;Perl SendMail Module $VERSION&quot;</span><span class="sc">;</span>
<span class="i">$_DEFAULT_SMTP_PORT</span> = <span class="n">25</span><span class="sc">;</span>

<span class="c">#</span>
<span class="c"># Some of the SMTP server needs to say &quot;HELO domain.address&quot;.</span>
<span class="c">#</span>
<span class="k">eval</span> <span class="s">{</span>
    <span class="k">require</span> <span class="w">Sys::Hostname</span><span class="sc">;</span>
    <span class="i">$_LOCALHOST</span> = <span class="i">Sys::Hostname::hostname</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
<span class="s">}</span><span class="sc">;</span>
<span class="i">$_LOCALHOST</span> = <span class="i">$_MAILER</span> <span class="k">if</span> <span class="i">$@</span><span class="sc">;</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># CONSTRUCTOR:	$obj = new SendMail;</span>
<span class="c">#		$obj = new SendMail($smtpserver);</span>
<span class="c">#		$obj = new SendMail($smtpserver, $smtpport);</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	This is the constructor of the SendMail object.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="new-"></a><span class="k">sub </span><span class="m">new</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$pkg</span><span class="s">)</span>        = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$smtpserver</span><span class="s">)</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$smtpport</span><span class="s">)</span>   = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span>       = <span class="s">{</span><span class="s">}</span><span class="sc">;</span>

    <span class="k">bless</span> <span class="i">$self</span><span class="cm">,</span> <span class="i">$pkg</span><span class="sc">;</span>

    <span class="c">#</span>
    <span class="c"># The mail server.</span>
    <span class="c">#</span>
    <span class="i">$self</span>-&gt;{<span class="q">&#39;smtpserver&#39;</span>} =
      <span class="s">(</span> <span class="i">$smtpserver</span> &amp;&amp; <span class="i">$smtpserver</span> !~ <span class="q">/^\s*$/</span> <span class="s">)</span> ? <span class="i">$smtpserver</span> <span class="co">:</span> <span class="q">&quot;localhost&quot;</span><span class="sc">;</span>

    <span class="c">#</span>
    <span class="c"># The port number for smtp.</span>
    <span class="c">#</span>
    <span class="i">$self</span>-&gt;{<span class="q">&#39;smtpport&#39;</span>} =
      <span class="s">(</span> <span class="i">$smtpport</span> &amp;&amp; <span class="i">$smtpport</span> =~ <span class="q">/^\d+$/</span> <span class="s">)</span>
      ? <span class="i">$smtpport</span>
      <span class="co">:</span> <span class="i">$_DEFAULT_SMTP_PORT</span><span class="sc">;</span>

    <span class="c">#</span>
    <span class="c"># The default debug mode is &quot;OFF&quot;.</span>
    <span class="c">#</span>
    <span class="i">$self</span>-&gt;{<span class="q">&#39;debugmode&#39;</span>} = <span class="i">$self</span><span class="i">-&gt;OFF</span><span class="sc">;</span>

    <span class="c">#</span>
    <span class="c"># Set the default mailer.</span>
    <span class="c">#</span>
    <span class="i">$self</span><span class="i">-&gt;setMailHeader</span><span class="s">(</span> <span class="q">&quot;X-MAILER&quot;</span><span class="cm">,</span> <span class="i">$_MAILER</span> <span class="s">)</span><span class="sc">;</span>

    <span class="c">#</span>
    <span class="c"># Create empty attachment array.</span>
    <span class="c">#</span>
    <span class="i">$self</span>-&gt;{<span class="q">&#39;attachmentArr&#39;</span>} = <span class="s">[</span><span class="s">]</span><span class="sc">;</span>

    <span class="c">#</span>
    <span class="c"># SMTP AUTH</span>
    <span class="c">#</span>
    <span class="i">$self</span>-&gt;{<span class="q">&#39;authtype&#39;</span>}     = <span class="q">&quot;&quot;</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="q">&#39;authuserid&#39;</span>}   = <span class="q">&quot;&quot;</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="q">&#39;authpassword&#39;</span>} = <span class="q">&quot;&quot;</span><span class="sc">;</span>

    <span class="k">return</span> <span class="i">$self</span><span class="sc">;</span>

<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;Attach($filename, [\$data]);</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	This method will attach file to the mail. If the data has been</span>
<span class="c">#		specified, will use the filename and the data, instead of</span>
<span class="c">#		reading from the file.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="Attach-"></a><span class="k">sub </span><span class="m">Attach ($;$)</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span>     = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$filename</span><span class="s">)</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$dataRef</span><span class="s">)</span>  = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">%hash</span><span class="cm">,</span> <span class="i">$dump</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">return</span> <span class="i">$self</span><span class="i">-&gt;setError</span><span class="s">(</span><span class="q">&quot;No attachment has been specified.&quot;</span><span class="s">)</span>
      <span class="k">if</span> <span class="i">$filename</span> =~ <span class="q">/^\s*$/</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$filename</span> =~ <span class="q">/(\\|\/)/</span> <span class="s">)</span> <span class="s">{</span>
        <span class="s">(</span> <span class="i">$hash</span>{<span class="q">&#39;filename&#39;</span>} <span class="s">)</span> = <span class="i">$filename</span> =~ <span class="q">/^.*[\\\/]([^\\\/]+)$/</span><span class="sc">;</span>
    <span class="s">}</span> <span class="k">else</span> <span class="s">{</span>
        <span class="i">$hash</span>{<span class="q">&#39;filename&#39;</span>} = <span class="i">$filename</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="i">$hash</span>{<span class="q">&#39;filepath&#39;</span>}   = <span class="i">$filename</span><span class="sc">;</span>
    <span class="i">$hash</span>{<span class="q">&#39;dataref&#39;</span>}    = <span class="i">$dataRef</span> <span class="k">if</span> <span class="k">ref</span><span class="s">(</span><span class="i">$dataRef</span><span class="s">)</span> !~ <span class="q">/^\s*$/</span><span class="sc">;</span>
    <span class="i">$hash</span>{<span class="q">&#39;attachtype&#39;</span>} = <span class="q">&quot;attachment&quot;</span><span class="sc">;</span>
    <span class="k">return</span> <span class="i">$self</span><span class="i">-&gt;attach</span><span class="s">(</span> \<span class="i">%hash</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;Bcc($bccemailadd1, [$bccemailadd2, ...]);</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	Add a list of the name/email address to the blind carbon copy</span>
<span class="c">#		list.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="Bcc-"></a><span class="k">sub </span><span class="m">Bcc ($)</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span>      = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">@bcc</span><span class="s">)</span>       = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$currEmail</span><span class="s">)</span> = <span class="k">undef</span><span class="sc">;</span>

    <span class="k">for</span> <span class="i">$currEmail</span> <span class="s">(</span><span class="i">@bcc</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">push</span><span class="s">(</span> <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;BCC&#39;</span>} }<span class="cm">,</span> <span class="i">$currEmail</span> <span class="s">)</span>
          <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span><span class="i">-&gt;getEmailAddress</span><span class="s">(</span><span class="i">$currEmail</span><span class="s">)</span> !~ <span class="q">/^\s*$/</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;Cc($ccemailadd1, [$ccemailadd2, ...]);</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	Add a list of the name/email address to the carbon copy list.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="Cc-"></a><span class="k">sub </span><span class="m">Cc ($)</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span>      = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">@cc</span><span class="s">)</span>        = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$currEmail</span><span class="s">)</span> = <span class="k">undef</span><span class="sc">;</span>

    <span class="k">for</span> <span class="i">$currEmail</span> <span class="s">(</span><span class="i">@cc</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">push</span><span class="s">(</span> <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;CC&#39;</span>} }<span class="cm">,</span> <span class="i">$currEmail</span> <span class="s">)</span>
          <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span><span class="i">-&gt;getEmailAddress</span><span class="s">(</span><span class="i">$currEmail</span><span class="s">)</span> !~ <span class="q">/^\s*$/</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;ErrorsTo($errorstoadd1, [$errorstoadd2, ...]);</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	Add a list of the name/email address into the &quot;Errors-To&quot; list.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="ErrorsTo-"></a><span class="k">sub </span><span class="m">ErrorsTo ($)</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span>      = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">@errorsto</span><span class="s">)</span>  = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$currEmail</span><span class="s">)</span> = <span class="k">undef</span><span class="sc">;</span>

    <span class="k">for</span> <span class="i">$currEmail</span> <span class="s">(</span><span class="i">@errorsto</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">push</span><span class="s">(</span> <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;ERRORS-TO&#39;</span>} }<span class="cm">,</span> <span class="i">$currEmail</span> <span class="s">)</span>
          <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span><span class="i">-&gt;getEmailAddress</span><span class="s">(</span><span class="i">$currEmail</span><span class="s">)</span> !~ <span class="q">/^\s*$/</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;From($sender);</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	Set the sender of the email.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="From-"></a><span class="k">sub </span><span class="m">From ($)</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$from</span><span class="s">)</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;FROM&#39;</span>} = <span class="i">$from</span><span class="sc">;</span>

    <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;Inline($filename, [\$data]);</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	This method will attach file to the mail. If the data has been</span>
<span class="c">#		specified, will use the filename and the data, instead of</span>
<span class="c">#		reading from the file.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="Inline-"></a><span class="k">sub </span><span class="m">Inline ($;$)</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span>     = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$filename</span><span class="s">)</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$dataRef</span><span class="s">)</span>  = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">%hash</span><span class="cm">,</span> <span class="i">$dump</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">return</span> <span class="i">$self</span><span class="i">-&gt;setError</span><span class="s">(</span><span class="q">&quot;No attachment has been specified.&quot;</span><span class="s">)</span>
      <span class="k">if</span> <span class="i">$filename</span> =~ <span class="q">/^\s*$/</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$filename</span> =~ <span class="q">/(\\|\/)/</span> <span class="s">)</span> <span class="s">{</span>
        <span class="s">(</span> <span class="i">$hash</span>{<span class="q">&#39;filename&#39;</span>} <span class="s">)</span> = <span class="i">$filename</span> =~ <span class="q">/^.*[\\\/]([^\\\/]+)$/</span><span class="sc">;</span>
    <span class="s">}</span> <span class="k">else</span> <span class="s">{</span>
        <span class="i">$hash</span>{<span class="q">&#39;filename&#39;</span>} = <span class="i">$filename</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="i">$hash</span>{<span class="q">&#39;filepath&#39;</span>}   = <span class="i">$filename</span><span class="sc">;</span>
    <span class="i">$hash</span>{<span class="q">&#39;dataref&#39;</span>}    = <span class="i">$dataRef</span> <span class="k">if</span> <span class="k">ref</span><span class="s">(</span><span class="i">$dataRef</span><span class="s">)</span> !~ <span class="q">/^\s*$/</span><span class="sc">;</span>
    <span class="i">$hash</span>{<span class="q">&#39;attachtype&#39;</span>} = <span class="q">&quot;inline&quot;</span><span class="sc">;</span>
    <span class="k">return</span> <span class="i">$self</span><span class="i">-&gt;attach</span><span class="s">(</span> \<span class="i">%hash</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;OFF;</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	Will return 0. Basically, it is used to set the debug mode OFF.</span>
<span class="c">#		Eg. $obj-&gt;setDebug($obj-&gt;OFF);</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="OFF-"></a><span class="k">sub </span><span class="m">OFF ()</span> <span class="s">{</span>
    <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;ON;</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	Will return 1. Basically, it is used to set the debug mode ON.</span>
<span class="c">#		Eg. $obj-&gt;setDebug($obj-&gt;ON);</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="ON-"></a><span class="k">sub </span><span class="m">ON ()</span> <span class="s">{</span>
    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;AUTHLOGIN;</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	Will return string &#39;AUTH LOGIN&#39;.</span>
<span class="c">#		Eg. $obj-&gt;setAuth($obj-&gt;AUTHLOGIN, $userid, $password);</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="AUTHLOGIN-"></a><span class="k">sub </span><span class="m">AUTHLOGIN ()</span> <span class="s">{</span>
    <span class="k">return</span> <span class="q">&#39;AUTH LOGIN&#39;</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;AUTHPLAIN;</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	Will return string &#39;AUTH PLAIN&#39;.</span>
<span class="c">#		Eg. $obj-&gt;setAuth($obj-&gt;AUTHPLAIN, $userid, $password);</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="AUTHPLAIN-"></a><span class="k">sub </span><span class="m">AUTHPLAIN ()</span> <span class="s">{</span>
    <span class="k">return</span> <span class="q">&#39;AUTH PLAIN&#39;</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;ReplyTo($replytoadd1, [$replytoadd2, ...]);</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	Add a list of the name/email address into the &quot;Reply-To&quot; list.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="ReplyTo-"></a><span class="k">sub </span><span class="m">ReplyTo ($;@)</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span>    = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">@replyto</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">push</span><span class="s">(</span> <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;REPLY-TO&#39;</span>} }<span class="cm">,</span> <span class="i">@replyto</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;Subject($subject);</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	Set the subject of the email.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="Subject-"></a><span class="k">sub </span><span class="m">Subject ($)</span> <span class="s">{</span>
    <span class="i">$_</span>[<span class="n">0</span>]-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;SUBJECT&#39;</span>} = <span class="i">$_</span>[<span class="n">1</span>]<span class="sc">;</span>

    <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;To($recipient1, [$recipient2, ...]);</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	Add a list of the name/email address to the recipient list.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="To-"></a><span class="k">sub </span><span class="m">To ($;@)</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">@to</span><span class="s">)</span>   = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">for</span> <span class="s">(</span><span class="i">@to</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="s">(</span><span class="i">$currEmail</span><span class="s">)</span> = <span class="i">$_</span><span class="sc">;</span>
        <span class="k">push</span><span class="s">(</span> <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;TO&#39;</span>} }<span class="cm">,</span> <span class="i">$currEmail</span> <span class="s">)</span>
          <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span><span class="i">-&gt;getEmailAddress</span><span class="s">(</span><span class="i">$currEmail</span><span class="s">)</span> !~ <span class="q">/^\s*$/</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;attach(\%hash);</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	This method will attach file to the mail. If the data has been</span>
<span class="c">#		specified, will use the filename and the data, instead of</span>
<span class="c">#		reading from the file.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="attach-1-"></a><span class="k">sub </span><span class="m">attach ($)</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span>    = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$dataRef</span><span class="s">)</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="k">return</span> <span class="i">$self</span><span class="i">-&gt;setError</span><span class="s">(</span><span class="q">&quot;No attachment has been specified.&quot;</span><span class="s">)</span>
      <span class="k">if</span> <span class="i">$dataRef</span>-&gt;{<span class="q">&#39;filename&#39;</span>} =~ <span class="q">/^\s*$/</span><span class="sc">;</span>
    <span class="k">push</span><span class="s">(</span> <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="q">&#39;attachmentArr&#39;</span>} }<span class="cm">,</span> <span class="i">$dataRef</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;clearAttach();</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	This method will clear the attachment stack.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="clearAttach-"></a><span class="k">sub </span><span class="m">clearAttach ()</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="q">&#39;attachmentArr&#39;</span>} = <span class="s">[</span><span class="s">]</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;clearBcc();</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	This method will clear the email addresses specified for Bcc:.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="clearBcc-"></a><span class="k">sub </span><span class="m">clearBcc ()</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;BCC&#39;</span>} = <span class="s">[</span><span class="s">]</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;clearCc();</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	This method will clear the email addresses specified for Cc:.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="clearCc-"></a><span class="k">sub </span><span class="m">clearCc ()</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;CC&#39;</span>} = <span class="s">[</span><span class="s">]</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;clearTo();</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	This method will clear the email addresses specified for To:.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="clearTo-"></a><span class="k">sub </span><span class="m">clearTo ()</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;TO&#39;</span>} = <span class="s">[</span><span class="s">]</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;createMailData();</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	This method will create the mail data which will be sent to the</span>
<span class="c">#		SMTP server. It will contain some mail headers and mail body.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="createMailData-"></a><span class="k">sub </span><span class="m">createMailData ()</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span>       = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$currHeader</span><span class="s">)</span> = <span class="k">undef</span><span class="sc">;</span>

    <span class="k">return</span> <span class="n">-1</span> <span class="k">if</span> <span class="i">$self</span><span class="i">-&gt;isMailReady</span><span class="s">(</span><span class="s">)</span> != <span class="n">0</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} = <span class="k">undef</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} = <span class="q">&quot;To: &quot;</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .=
      <span class="k">join</span><span class="s">(</span> <span class="q">&quot;,\r\n\t&quot;</span><span class="cm">,</span> <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;TO&#39;</span>} } <span class="s">)</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .=
      <span class="q">&quot;\r\nFrom: &quot;</span> . <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;FROM&#39;</span>} . <span class="q">&quot;\r\n&quot;</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .=
      <span class="q">&quot;Subject: &quot;</span> . <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;SUBJECT&#39;</span>} . <span class="q">&quot;\r\n&quot;</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;CC&#39;</span>}
        &amp;&amp; <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;CC&#39;</span>} } &gt; <span class="n">0</span> <span class="s">)</span>
    <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .= <span class="q">&quot;Cc: &quot;</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .=
          <span class="k">join</span><span class="s">(</span> <span class="q">&quot;,\r\n\t&quot;</span><span class="cm">,</span> <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;CC&#39;</span>} } <span class="s">)</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .= <span class="q">&quot;\r\n&quot;</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;REPLY-TO&#39;</span>}
        &amp;&amp; <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;REPLY-TO&#39;</span>} } &gt; <span class="n">0</span> <span class="s">)</span>
    <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .= <span class="q">&quot;Reply-To: &quot;</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .=
          <span class="k">join</span><span class="s">(</span> <span class="q">&quot;,\r\n\t&quot;</span><span class="cm">,</span> <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;REPLY-TO&#39;</span>} } <span class="s">)</span> . <span class="q">&quot;\r\n&quot;</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;ERRORS-TO&#39;</span>}
        &amp;&amp; <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;ERRORS-TO&#39;</span>} } &gt; <span class="n">0</span> <span class="s">)</span>
    <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .= <span class="q">&quot;Errors-To: &quot;</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .=
          <span class="k">join</span><span class="s">(</span> <span class="q">&quot;,\r\n\t&quot;</span><span class="cm">,</span> <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;ERRORS-TO&#39;</span>} } <span class="s">)</span>
          . <span class="q">&quot;\r\n&quot;</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">for</span> <span class="i">$currHeader</span> <span class="s">(</span> <span class="k">sort</span> <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;OTHERS&#39;</span>} } <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="s">(</span><span class="i">$currMailHeader</span><span class="s">)</span> = <span class="k">undef</span><span class="sc">;</span>
        <span class="s">(</span> <span class="i">$currMailHeader</span> = <span class="i">$currHeader</span> <span class="s">)</span> =~ <span class="q">s/\b(\w)(\w+)\b/$1\L$2/g</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .= <span class="q">&quot;$currMailHeader: &quot;</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .=
          <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;OTHERS&#39;</span>}-&gt;{<span class="i">$currHeader</span>}<span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .= <span class="q">&quot;\r\n&quot;</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">scalar</span><span class="s">(</span> <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="q">&#39;attachmentArr&#39;</span>} } <span class="s">)</span> &gt; <span class="n">0</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="s">(</span><span class="i">$currHash</span><span class="s">)</span><span class="sc">;</span>
        <span class="k">srand</span><span class="s">(</span> <span class="k">time</span> ^ <span class="i">$$</span> <span class="s">)</span><span class="sc">;</span>
        <span class="k">my</span> <span class="s">(</span><span class="i">$boundary</span><span class="s">)</span> = <span class="q">&quot;==__SENDMAIL__&quot;</span>
          . <span class="k">join</span><span class="s">(</span> <span class="q">&quot;&quot;</span><span class="cm">,</span>
            <span class="s">(</span> <span class="q">&#39;a&#39;</span> .. <span class="q">&#39;z&#39;</span><span class="cm">,</span> <span class="q">&#39;A&#39;</span> .. <span class="q">&#39;Z&#39;</span><span class="cm">,</span> <span class="n">0</span> .. <span class="n">9</span> <span class="s">)</span>[ <span class="k">map</span> <span class="k">rand</span> <span class="i">$_</span><span class="cm">,</span> <span class="s">(</span><span class="n">62</span><span class="s">)</span> x <span class="n">25</span> ] <span class="s">)</span>
          . <span class="q">&quot;__==&quot;</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .= <span class="q">&quot;MIME-Version: 1.0\r\n&quot;</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .= <span class="q">&quot;Content-Type: multipart/mixed; &quot;</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .= <span class="q">&quot;boundary=\&quot;$boundary\&quot;\r\n&quot;</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .= <span class="q">&quot;\r\n&quot;</span><span class="sc">;</span>

        <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="q">&#39;mailbody&#39;</span>} <span class="s">)</span> <span class="s">{</span>
            <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .= <span class="q">&quot;\-\-$boundary\r\n&quot;</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .=
              <span class="q">&quot;Content-Type: text/plain; charset=\&quot;iso-8859-1\&quot;\r\n&quot;</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .= <span class="q">&quot;Content-Transfer-Encoding: base64\r\n\r\n&quot;</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .=
              <span class="i">encode_base64</span><span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="q">&#39;mailbody&#39;</span>}<span class="cm">,</span> <span class="q">&quot;\r\n&quot;</span> <span class="s">)</span> . <span class="q">&quot;\r\n\r\n&quot;</span><span class="sc">;</span>
        <span class="s">}</span>

        <span class="k">for</span> <span class="i">$currHash</span> <span class="s">(</span> <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="q">&#39;attachmentArr&#39;</span>} } <span class="s">)</span> <span class="s">{</span>
            <span class="i">$currHash</span>-&gt;{<span class="q">&#39;content-type&#39;</span>} =
              <span class="i">$self</span><span class="i">-&gt;getMIMEType</span><span class="s">(</span> <span class="i">$currHash</span>-&gt;{<span class="q">&#39;filename&#39;</span>} <span class="s">)</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .= <span class="q">&quot;\-\-$boundary\r\n&quot;</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .=
<span class="q">&quot;Content-Type: $currHash-&gt;{&#39;content-type&#39;}; name=\&quot;$currHash-&gt;{&#39;filename&#39;}\&quot;\r\n&quot;</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .= <span class="q">&quot;Content-Transfer-Encoding: base64\r\n&quot;</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .=
<span class="q">&quot;Content-Disposition: $currHash-&gt;{&#39;attachtype&#39;}; filename=\&quot;$currHash-&gt;{&#39;filename&#39;}\&quot;\r\n&quot;</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .= <span class="q">&quot;\r\n&quot;</span><span class="sc">;</span>

            <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$currHash</span>-&gt;{<span class="q">&#39;dataref&#39;</span>} <span class="s">)</span> <span class="s">{</span>
                <span class="k">if</span> <span class="s">(</span> <span class="k">ref</span><span class="s">(</span> <span class="i">$currHash</span>-&gt;{<span class="q">&#39;dataref&#39;</span>} <span class="s">)</span> <span class="k">eq</span> <span class="q">&quot;SCALAR&quot;</span> <span class="s">)</span> <span class="s">{</span>
                    <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .=
                      <span class="i">encode_base64</span><span class="s">(</span> <span class="i">$</span>{ <span class="i">$currHash</span>-&gt;{<span class="q">&#39;dataref&#39;</span>} }<span class="cm">,</span> <span class="q">&quot;\r\n&quot;</span> <span class="s">)</span><span class="sc">;</span>
                <span class="s">}</span> <span class="k">else</span> <span class="s">{</span>
                    <span class="k">my</span> <span class="s">(</span><span class="i">$data</span><span class="s">)</span> = <span class="k">undef</span><span class="sc">;</span>
                    <span class="k">my</span> <span class="s">(</span><span class="i">$buff</span><span class="s">)</span> = <span class="q">&quot;&quot;</span><span class="sc">;</span>
                    <span class="k">my</span> <span class="s">(</span><span class="i">$pos</span><span class="s">)</span>  = <span class="n">0</span><span class="sc">;</span>
                    <span class="s">(</span> <span class="k">defined</span><span class="s">(</span> <span class="i">$pos</span> = <span class="k">tell</span><span class="s">(</span> <span class="i">$currHash</span>-&gt;{<span class="q">&#39;dataref&#39;</span>} <span class="s">)</span> <span class="s">)</span> <span class="s">)</span>
                      || <span class="k">return</span> <span class="i">$self</span><span class="i">-&gt;setError</span><span class="s">(</span><span class="q">&quot;Error in tell(): $!&quot;</span><span class="s">)</span><span class="sc">;</span>
                    <span class="k">while</span> <span class="s">(</span> <span class="k">read</span><span class="s">(</span> <span class="i">$currHash</span>-&gt;{<span class="q">&#39;dataref&#39;</span>}<span class="cm">,</span> <span class="i">$buff</span><span class="cm">,</span> <span class="n">1024</span> <span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
                        <span class="i">$data</span> .= <span class="i">$buff</span><span class="sc">;</span>
                    <span class="s">}</span>
                    <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .= <span class="i">encode_base64</span><span class="s">(</span> <span class="i">$data</span><span class="cm">,</span> <span class="q">&quot;\r\n&quot;</span> <span class="s">)</span><span class="sc">;</span>
                    <span class="k">seek</span><span class="s">(</span> <span class="i">$currHash</span>-&gt;{<span class="q">&#39;dataref&#39;</span>}<span class="cm">,</span> <span class="i">$pos</span><span class="cm">,</span> <span class="n">0</span> <span class="s">)</span>
                      || <span class="k">return</span> <span class="i">$self</span><span class="i">-&gt;setError</span><span class="s">(</span><span class="q">&quot;Error in seek(): $!&quot;</span><span class="s">)</span><span class="sc">;</span>
                <span class="s">}</span>
            <span class="s">}</span> <span class="k">elsif</span> <span class="s">(</span> <span class="k">-f</span> <span class="i">$currHash</span>-&gt;{<span class="q">&#39;filepath&#39;</span>} <span class="s">)</span> <span class="s">{</span>
                <span class="k">my</span> <span class="s">(</span><span class="i">$data</span><span class="s">)</span> = <span class="k">undef</span><span class="sc">;</span>
                <span class="k">my</span> <span class="s">(</span><span class="i">$buff</span><span class="s">)</span> = <span class="q">&quot;&quot;</span><span class="sc">;</span>
                <span class="k">open</span><span class="s">(</span> <span class="w">FILE</span><span class="cm">,</span> <span class="i">$currHash</span>-&gt;{<span class="q">&#39;filepath&#39;</span>} <span class="s">)</span><span class="sc">;</span>

             <span class="c"># In Windows platform, non-text file should use binmode() function.</span>
                <span class="k">if</span> <span class="s">(</span> !<span class="k">-T</span> <span class="i">$currHash</span>-&gt;{<span class="q">&#39;filepath&#39;</span>} <span class="s">)</span> <span class="s">{</span>
                    <span class="k">binmode</span><span class="s">(</span><span class="w">FILE</span><span class="s">)</span><span class="sc">;</span>
                <span class="s">}</span>
                <span class="k">while</span> <span class="s">(</span> <span class="k">sysread</span><span class="s">(</span> <span class="w">FILE</span><span class="cm">,</span> <span class="i">$buff</span><span class="cm">,</span> <span class="n">1024</span> <span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
                    <span class="i">$data</span> .= <span class="i">$buff</span><span class="sc">;</span>
                <span class="s">}</span>
                <span class="k">close</span><span class="s">(</span><span class="w">FILE</span><span class="s">)</span><span class="sc">;</span>
                <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .= <span class="i">encode_base64</span><span class="s">(</span> <span class="i">$data</span><span class="cm">,</span> <span class="q">&quot;\r\n&quot;</span> <span class="s">)</span><span class="sc">;</span>
            <span class="s">}</span> <span class="k">else</span> <span class="s">{</span>
                <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .= <span class="i">encode_base64</span><span class="s">(</span> <span class="q">&quot;&quot;</span><span class="cm">,</span> <span class="q">&quot;\r\n&quot;</span> <span class="s">)</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .= <span class="q">&quot;\r\n&quot;</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .= <span class="q">&quot;\-\-${boundary}\-\-\r\n&quot;</span><span class="sc">;</span>
    <span class="s">}</span> <span class="k">else</span> <span class="s">{</span>
        <span class="k">my</span> <span class="s">(</span><span class="i">$tmpbody</span><span class="s">)</span> = <span class="i">$self</span>-&gt;{<span class="q">&#39;mailbody&#39;</span>}<span class="sc">;</span>
        <span class="i">$tmpbody</span> =~ <span class="q">s/([^\r])\n/$1\r\n/g</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .= <span class="q">&quot;\r\n&quot;</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>} .= <span class="q">&quot;$tmpbody\r\n&quot;</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;getEmailAddress($emailaddstr);</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	Get the email address from the email address string which might</span>
<span class="c">#		contain email account owner&#39;s name, what we want is the email</span>
<span class="c">#		address only.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="getEmailAddress-"></a><span class="k">sub </span><span class="m">getEmailAddress ($)</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span>     = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$value</span><span class="s">)</span>    = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$retvalue</span><span class="s">)</span> = <span class="k">undef</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$value</span> =~ <span class="q">/^\&lt;([^\&gt;\@]+\@[\w\-]+(\.[\w\-]+)+)\&gt;/</span> <span class="s">)</span> <span class="s">{</span>
        <span class="s">(</span> <span class="i">$retvalue</span> = <span class="i">$1</span> <span class="s">)</span> =~ <span class="q">tr/[A-Z]/[a-z]/</span><span class="sc">;</span>
        <span class="k">return</span> <span class="i">$retvalue</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$value</span> =~ <span class="q">/^[^\&lt;]+\&lt;([^\&gt;\@]+\@[\w\-]+(\.[\w\-]+)+)\&gt;/</span> <span class="s">)</span> <span class="s">{</span>
        <span class="s">(</span> <span class="i">$retvalue</span> = <span class="i">$1</span> <span class="s">)</span> =~ <span class="q">tr/[A-Z]/[a-z]/</span><span class="sc">;</span>
        <span class="k">return</span> <span class="i">$retvalue</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">return</span> <span class="q">&quot;&quot;</span> <span class="k">if</span> <span class="i">$value</span> =~ <span class="q">/\s+/</span><span class="sc">;</span>

    <span class="i">$value</span> =~ <span class="q">tr/[A-Z]/[a-z]/</span><span class="sc">;</span>
    <span class="k">return</span> <span class="i">$value</span> <span class="k">if</span> <span class="i">$value</span> =~ <span class="q">/^[^\@]+\@[\w\-]+(\.[\w\-]+)+$/</span><span class="sc">;</span>

    <span class="k">return</span> <span class="q">&quot;&quot;</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;getMIMEType($filename);</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	This will return MIME type for $filename.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="getMIMEType-"></a><span class="k">sub </span><span class="m">getMIMEType ($)</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span>     = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$filename</span><span class="s">)</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">$ext</span><span class="cm">,</span> <span class="i">%MIMEHash</span> <span class="s">)</span><span class="sc">;</span>

    <span class="i">%MIMEHash</span> = <span class="s">(</span>
        <span class="q">&#39;au&#39;</span>    <span class="cm">=&gt;</span> <span class="q">&#39;audio/basic&#39;</span><span class="cm">,</span>
        <span class="q">&#39;avi&#39;</span>   <span class="cm">=&gt;</span> <span class="q">&#39;video/x-msvideo&#39;</span><span class="cm">,</span>
        <span class="q">&#39;class&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;application/octet-stream&#39;</span><span class="cm">,</span>
        <span class="q">&#39;cpt&#39;</span>   <span class="cm">=&gt;</span> <span class="q">&#39;application/mac-compactpro&#39;</span><span class="cm">,</span>
        <span class="q">&#39;dcr&#39;</span>   <span class="cm">=&gt;</span> <span class="q">&#39;application/x-director&#39;</span><span class="cm">,</span>
        <span class="q">&#39;dir&#39;</span>   <span class="cm">=&gt;</span> <span class="q">&#39;application/x-director&#39;</span><span class="cm">,</span>
        <span class="q">&#39;doc&#39;</span>   <span class="cm">=&gt;</span> <span class="q">&#39;application/msword&#39;</span><span class="cm">,</span>
        <span class="q">&#39;exe&#39;</span>   <span class="cm">=&gt;</span> <span class="q">&#39;application/octet-stream&#39;</span><span class="cm">,</span>
        <span class="q">&#39;gif&#39;</span>   <span class="cm">=&gt;</span> <span class="q">&#39;image/gif&#39;</span><span class="cm">,</span>
        <span class="q">&#39;gtx&#39;</span>   <span class="cm">=&gt;</span> <span class="q">&#39;application/x-gentrix&#39;</span><span class="cm">,</span>
        <span class="q">&#39;jpeg&#39;</span>  <span class="cm">=&gt;</span> <span class="q">&#39;image/jpeg&#39;</span><span class="cm">,</span>
        <span class="q">&#39;jpg&#39;</span>   <span class="cm">=&gt;</span> <span class="q">&#39;image/jpeg&#39;</span><span class="cm">,</span>
        <span class="q">&#39;js&#39;</span>    <span class="cm">=&gt;</span> <span class="q">&#39;application/x-javascript&#39;</span><span class="cm">,</span>
        <span class="q">&#39;hqx&#39;</span>   <span class="cm">=&gt;</span> <span class="q">&#39;application/mac-binhex40&#39;</span><span class="cm">,</span>
        <span class="q">&#39;htm&#39;</span>   <span class="cm">=&gt;</span> <span class="q">&#39;text/html&#39;</span><span class="cm">,</span>
        <span class="q">&#39;html&#39;</span>  <span class="cm">=&gt;</span> <span class="q">&#39;text/html&#39;</span><span class="cm">,</span>
        <span class="q">&#39;mid&#39;</span>   <span class="cm">=&gt;</span> <span class="q">&#39;audio/midi&#39;</span><span class="cm">,</span>
        <span class="q">&#39;midi&#39;</span>  <span class="cm">=&gt;</span> <span class="q">&#39;audio/midi&#39;</span><span class="cm">,</span>
        <span class="q">&#39;mov&#39;</span>   <span class="cm">=&gt;</span> <span class="q">&#39;video/quicktime&#39;</span><span class="cm">,</span>
        <span class="q">&#39;mp2&#39;</span>   <span class="cm">=&gt;</span> <span class="q">&#39;audio/mpeg&#39;</span><span class="cm">,</span>
        <span class="q">&#39;mp3&#39;</span>   <span class="cm">=&gt;</span> <span class="q">&#39;audio/mpeg&#39;</span><span class="cm">,</span>
        <span class="q">&#39;mpeg&#39;</span>  <span class="cm">=&gt;</span> <span class="q">&#39;video/mpeg&#39;</span><span class="cm">,</span>
        <span class="q">&#39;mpg&#39;</span>   <span class="cm">=&gt;</span> <span class="q">&#39;video/mpeg&#39;</span><span class="cm">,</span>
        <span class="q">&#39;pdf&#39;</span>   <span class="cm">=&gt;</span> <span class="q">&#39;application/pdf&#39;</span><span class="cm">,</span>
        <span class="q">&#39;pm&#39;</span>    <span class="cm">=&gt;</span> <span class="q">&#39;text/plain&#39;</span><span class="cm">,</span>
        <span class="q">&#39;pl&#39;</span>    <span class="cm">=&gt;</span> <span class="q">&#39;text/plain&#39;</span><span class="cm">,</span>
        <span class="q">&#39;ppt&#39;</span>   <span class="cm">=&gt;</span> <span class="q">&#39;application/powerpoint&#39;</span><span class="cm">,</span>
        <span class="q">&#39;ps&#39;</span>    <span class="cm">=&gt;</span> <span class="q">&#39;application/postscript&#39;</span><span class="cm">,</span>
        <span class="q">&#39;qt&#39;</span>    <span class="cm">=&gt;</span> <span class="q">&#39;video/quicktime&#39;</span><span class="cm">,</span>
        <span class="q">&#39;ram&#39;</span>   <span class="cm">=&gt;</span> <span class="q">&#39;audio/x-pn-realaudio&#39;</span><span class="cm">,</span>
        <span class="q">&#39;rtf&#39;</span>   <span class="cm">=&gt;</span> <span class="q">&#39;application/rtf&#39;</span><span class="cm">,</span>
        <span class="q">&#39;tar&#39;</span>   <span class="cm">=&gt;</span> <span class="q">&#39;application/x-tar&#39;</span><span class="cm">,</span>
        <span class="q">&#39;tif&#39;</span>   <span class="cm">=&gt;</span> <span class="q">&#39;image/tiff&#39;</span><span class="cm">,</span>
        <span class="q">&#39;tiff&#39;</span>  <span class="cm">=&gt;</span> <span class="q">&#39;image/tiff&#39;</span><span class="cm">,</span>
        <span class="q">&#39;txt&#39;</span>   <span class="cm">=&gt;</span> <span class="q">&#39;text/plain&#39;</span><span class="cm">,</span>
        <span class="q">&#39;wav&#39;</span>   <span class="cm">=&gt;</span> <span class="q">&#39;audio/x-wav&#39;</span><span class="cm">,</span>
        <span class="q">&#39;xbm&#39;</span>   <span class="cm">=&gt;</span> <span class="q">&#39;image/x-xbitmap&#39;</span><span class="cm">,</span>
        <span class="q">&#39;zip&#39;</span>   <span class="cm">=&gt;</span> <span class="q">&#39;application/zip&#39;</span><span class="cm">,</span>
    <span class="s">)</span><span class="sc">;</span>
    <span class="s">(</span><span class="i">$ext</span><span class="s">)</span> = <span class="i">$filename</span> =~ <span class="q">/\.([^\.]+)$/</span><span class="sc">;</span>
    <span class="i">$ext</span> =~ <span class="q">tr/[A-Z]/[a-z]/</span><span class="sc">;</span>

    <span class="k">return</span>
      <span class="k">defined</span> <span class="i">$MIMEHash</span>{<span class="i">$ext</span>} ? <span class="i">$MIMEHash</span>{<span class="i">$ext</span>} <span class="co">:</span> <span class="q">&quot;application/octet-stream&quot;</span><span class="sc">;</span>

<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;getRcptLists();</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	This will generate an array of the recipients&#39; email address.</span>
<span class="c">#		Basically, this method only called by $obj-&gt;sendMail() method,</span>
<span class="c">#		which needs to send &quot;RCPT TO:&quot; request to the SMTP server.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="getRcptLists-"></a><span class="k">sub </span><span class="m">getRcptLists ()</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span>      = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">@rcptLists</span><span class="s">)</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$currEmail</span><span class="s">)</span> = <span class="k">undef</span><span class="sc">;</span>

    <span class="k">for</span> <span class="i">$currEmail</span> <span class="s">(</span> <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;TO&#39;</span>} } <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="s">(</span><span class="i">$currEmail</span><span class="s">)</span> = <span class="i">$self</span><span class="i">-&gt;getEmailAddress</span><span class="s">(</span><span class="i">$currEmail</span><span class="s">)</span><span class="sc">;</span>
        <span class="k">push</span><span class="s">(</span> <span class="i">@rcptLists</span><span class="cm">,</span> <span class="i">$currEmail</span> <span class="s">)</span>
          <span class="k">if</span> <span class="s">(</span> <span class="i">$currEmail</span> !~ <span class="q">/^\s*$/</span>
            &amp;&amp; <span class="s">(</span> !<span class="k">grep</span><span class="s">(</span> <span class="q">/^$currEmail$/</span><span class="cm">,</span> <span class="i">@rcptLists</span> <span class="s">)</span> <span class="s">)</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;BCC&#39;</span>}
        &amp;&amp; <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;BCC&#39;</span>} } &gt; <span class="n">0</span> <span class="s">)</span>
    <span class="s">{</span>
        <span class="k">for</span> <span class="i">$currEmail</span> <span class="s">(</span> <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;BCC&#39;</span>} } <span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="s">(</span><span class="i">$currEmail</span><span class="s">)</span> = <span class="i">$self</span><span class="i">-&gt;getEmailAddress</span><span class="s">(</span><span class="i">$currEmail</span><span class="s">)</span><span class="sc">;</span>
            <span class="k">push</span><span class="s">(</span> <span class="i">@rcptLists</span><span class="cm">,</span> <span class="i">$currEmail</span> <span class="s">)</span>
              <span class="k">if</span> <span class="s">(</span> <span class="i">$currEmail</span> !~ <span class="q">/^\s*$/</span>
                &amp;&amp; <span class="s">(</span> !<span class="k">grep</span><span class="s">(</span> <span class="q">/^$currEmail$/</span><span class="cm">,</span> <span class="i">@rcptLists</span> <span class="s">)</span> <span class="s">)</span> <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;CC&#39;</span>}
        &amp;&amp; <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;CC&#39;</span>} } &gt; <span class="n">0</span> <span class="s">)</span>
    <span class="s">{</span>
        <span class="k">for</span> <span class="i">$currEmail</span> <span class="s">(</span> <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;CC&#39;</span>} } <span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="s">(</span><span class="i">$currEmail</span><span class="s">)</span> = <span class="i">$self</span><span class="i">-&gt;getEmailAddress</span><span class="s">(</span><span class="i">$currEmail</span><span class="s">)</span><span class="sc">;</span>
            <span class="k">push</span><span class="s">(</span> <span class="i">@rcptLists</span><span class="cm">,</span> <span class="i">$currEmail</span> <span class="s">)</span>
              <span class="k">if</span> <span class="s">(</span> <span class="i">$currEmail</span> !~ <span class="q">/^\s*$/</span>
                &amp;&amp; <span class="s">(</span> !<span class="k">grep</span><span class="s">(</span> <span class="q">/^$currEmail$/</span><span class="cm">,</span> <span class="i">@rcptLists</span> <span class="s">)</span> <span class="s">)</span> <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>

    <span class="k">return</span> \<span class="i">@rcptLists</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;isMailReady();</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	Check if the basic mail headers and the mail body have been set</span>
<span class="c">#		or not.</span>
<span class="c">#		p/s: The &quot;From:&quot;, &quot;To:&quot; and &quot;Subject:&quot; mail headers are required</span>
<span class="c">#		here, I feel that a mail should contain these headers. It is</span>
<span class="c">#		just a personal opinion, if you do not think so, just comment</span>
<span class="c">#		them out.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="isMailReady-"></a><span class="k">sub </span><span class="m">isMailReady ()</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="k">return</span> <span class="i">$self</span><span class="i">-&gt;setError</span><span class="s">(</span><span class="q">&quot;No sender has been specified.&quot;</span><span class="s">)</span>
      <span class="k">if</span> !<span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;FROM&#39;</span>}<span class="sc">;</span>

    <span class="k">return</span> <span class="i">$self</span><span class="i">-&gt;setError</span><span class="s">(</span><span class="q">&quot;No recipient has been specified.&quot;</span><span class="s">)</span>
      <span class="k">if</span> <span class="s">(</span>
        <span class="s">(</span> !<span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;TO&#39;</span>} <span class="s">)</span>
        || <span class="s">(</span> <span class="k">defined</span> <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;TO&#39;</span>} }
            &amp;&amp; <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;TO&#39;</span>} } &lt; <span class="n">1</span> <span class="s">)</span>
      <span class="s">)</span><span class="sc">;</span>

    <span class="k">return</span> <span class="i">$self</span><span class="i">-&gt;setError</span><span class="s">(</span><span class="q">&quot;No subject has been specified.&quot;</span><span class="s">)</span>
      <span class="k">if</span> !<span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;SUBJECT&#39;</span>}<span class="sc">;</span>

    <span class="k">return</span> <span class="i">$self</span><span class="i">-&gt;setError</span><span class="s">(</span><span class="q">&quot;No mail body has been set.&quot;</span><span class="s">)</span>
      <span class="k">if</span> <span class="s">(</span> <span class="s">(</span> !<span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="q">&#39;mailbody&#39;</span>} <span class="s">)</span>
        &amp;&amp; <span class="s">(</span> <span class="k">scalar</span><span class="s">(</span> <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="q">&#39;attachmentArr&#39;</span>} } <span class="s">)</span> &lt; <span class="n">1</span> <span class="s">)</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;receiveFromServer(\*SOCKET);</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	This will receive the data replied from the server.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="receiveFromServer-"></a><span class="k">sub </span><span class="m">receiveFromServer ($)</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span>   = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$socket</span><span class="s">)</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$reply</span><span class="s">)</span><span class="sc">;</span>

    <span class="c">#</span>
    <span class="c"># We keep receiveing the data from the server until</span>
    <span class="c"># it waits for next command.</span>
    <span class="c">#</span>
    <span class="k">while</span> <span class="s">(</span> <span class="i">$socket</span> &amp;&amp; <span class="s">(</span> <span class="i">$reply</span> = <span class="q">&lt;$socket&gt;</span> <span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">return</span> <span class="i">$self</span><span class="i">-&gt;setError</span><span class="s">(</span><span class="i">$reply</span><span class="s">)</span> <span class="k">if</span> <span class="i">$reply</span> =~ <span class="q">/^5/</span><span class="sc">;</span>
        <span class="k">print</span> <span class="i">$reply</span>                   <span class="k">if</span> <span class="i">$self</span>-&gt;{<span class="q">&#39;debugmode&#39;</span>}<span class="sc">;</span>
        <span class="k">last</span>                           <span class="k">if</span> <span class="i">$reply</span> =~ <span class="q">/^\d+ /</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;reset();</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	This will clear the data that have been set before.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="reset-"></a><span class="k">sub </span><span class="m">reset ()</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="q">&#39;debugmode&#39;</span>}     = <span class="i">$self</span><span class="i">-&gt;OFF</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="q">&#39;mailbody&#39;</span>}      = <span class="k">undef</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="q">&#39;maildata&#39;</span>}      = <span class="k">undef</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}   = <span class="k">undef</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="q">&#39;sender&#39;</span>}        = <span class="k">undef</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="q">&#39;attachmentArr&#39;</span>} = <span class="s">[</span><span class="s">]</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="q">&#39;authtype&#39;</span>}      = <span class="q">&quot;&quot;</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="q">&#39;authuserid&#39;</span>}    = <span class="q">&quot;&quot;</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="q">&#39;authpassword&#39;</span>}  = <span class="q">&quot;&quot;</span><span class="sc">;</span>

    <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;sendMail();</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	This will use the Socket to connect to the SMTP port to send the#		mail.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="sendMail-"></a><span class="k">sub </span><span class="m">sendMail ()</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">$iaddr</span><span class="cm">,</span> <span class="i">$paddr</span><span class="cm">,</span> <span class="i">$proto</span><span class="cm">,</span> <span class="i">$rcptlistRef</span><span class="cm">,</span> <span class="i">$currEmail</span> <span class="s">)</span> = <span class="k">undef</span><span class="sc">;</span>

    <span class="c">#</span>
    <span class="c"># Get the sender&#39;s email address, this will be used in &quot;MAIL FROM:&quot; request.</span>
    <span class="c">#</span>
    <span class="i">$self</span>-&gt;{<span class="q">&#39;sender&#39;</span>} =
      <span class="i">$self</span><span class="i">-&gt;getEmailAddress</span><span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;FROM&#39;</span>} <span class="s">)</span><span class="sc">;</span>

    <span class="c">#</span>
    <span class="c"># Invalid email address format.</span>
    <span class="c">#</span>
    <span class="k">return</span> <span class="i">$self</span><span class="i">-&gt;setError</span><span class="s">(</span><span class="q">&quot;Please check the sender&#39;s email address setting.&quot;</span><span class="s">)</span>
      <span class="k">if</span> <span class="i">$self</span>-&gt;{<span class="q">&#39;sender&#39;</span>} =~ <span class="q">/^\s*$/</span><span class="sc">;</span>

    <span class="c">#</span>
    <span class="c"># We create the mail data here.</span>
    <span class="c">#</span>
    <span class="k">return</span> <span class="n">-1</span> <span class="k">if</span> <span class="i">$self</span><span class="i">-&gt;createMailData</span><span class="s">(</span><span class="s">)</span> != <span class="n">0</span><span class="sc">;</span>

    <span class="c">#</span>
    <span class="c"># We get the recipients&#39; email addresses.</span>
    <span class="c">#</span>
    <span class="i">$rcptlistRef</span> = <span class="i">$self</span><span class="i">-&gt;getRcptLists</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>

    <span class="c">#</span>
    <span class="c"># If no recipient has been specified, this is an error.</span>
    <span class="c">#</span>
    <span class="k">return</span> <span class="i">$self</span><span class="i">-&gt;setError</span><span class="s">(</span><span class="q">&quot;No recipient has been specified.&quot;</span><span class="s">)</span>
      <span class="k">if</span> <span class="i">@</span>{<span class="i">$rcptlistRef</span>} == <span class="n">0</span><span class="sc">;</span>

    <span class="c">#</span>
    <span class="c"># Please refer to Socket module manual. (perldoc Socket)</span>
    <span class="c">#</span>
    <span class="i">$iaddr</span> = <span class="i">inet_aton</span><span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="q">&#39;smtpserver&#39;</span>} <span class="s">)</span>
      || <span class="k">return</span> <span class="i">$self</span><span class="i">-&gt;setError</span><span class="s">(</span>
<span class="q">&quot;no host: $self-&gt;{&#39;smtpserver&#39;}, please specify SMTP server with \&quot;\$obj = new SendMail(&#39;your.smtp.server&#39;);\&quot;&quot;</span>
      <span class="s">)</span><span class="sc">;</span>
    <span class="i">$paddr</span> = <span class="i">sockaddr_in</span><span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="q">&#39;smtpport&#39;</span>}<span class="cm">,</span> <span class="i">$iaddr</span> <span class="s">)</span><span class="sc">;</span>
    <span class="i">$proto</span> = <span class="k">getprotobyname</span><span class="s">(</span><span class="q">&#39;tcp&#39;</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">socket</span><span class="s">(</span> <span class="w">SOCK</span><span class="cm">,</span> <span class="w">PF_INET</span><span class="cm">,</span> <span class="w">SOCK_STREAM</span><span class="cm">,</span> <span class="i">$proto</span> <span class="s">)</span>
      || <span class="k">return</span> <span class="i">$self</span><span class="i">-&gt;setError</span><span class="s">(</span><span class="q">&quot;Socket error: $!&quot;</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">connect</span><span class="s">(</span> <span class="w">SOCK</span><span class="cm">,</span> <span class="i">$paddr</span> <span class="s">)</span>
      || <span class="k">return</span> <span class="i">$self</span><span class="i">-&gt;setError</span><span class="s">(</span>
<span class="q">&quot;Error in connecting to $self-&gt;{&#39;smtpserver&#39;} at port $self-&gt;{&#39;smtpport&#39;}: $!&quot;</span>
      <span class="s">)</span><span class="sc">;</span>

    <span class="k">return</span> <span class="n">-1</span> <span class="k">if</span> <span class="i">$self</span><span class="i">-&gt;receiveFromServer</span><span class="s">(</span> \<span class="i">*SOCK</span> <span class="s">)</span> != <span class="n">0</span><span class="sc">;</span>
    <span class="k">return</span> <span class="n">-1</span> <span class="k">if</span> <span class="i">$self</span><span class="i">-&gt;sendToServer</span><span class="s">(</span> \<span class="i">*SOCK</span><span class="cm">,</span> <span class="q">&quot;EHLO $_LOCALHOST&quot;</span> <span class="s">)</span> != <span class="n">0</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span><span class="i">-&gt;receiveFromServer</span><span class="s">(</span> \<span class="i">*SOCK</span> <span class="s">)</span> != <span class="n">0</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">return</span> <span class="n">-1</span> <span class="k">if</span> <span class="i">$self</span><span class="i">-&gt;sendToServer</span><span class="s">(</span> \<span class="i">*SOCK</span><span class="cm">,</span> <span class="q">&quot;HELO $_LOCALHOST&quot;</span> <span class="s">)</span> != <span class="n">0</span><span class="sc">;</span>
        <span class="k">return</span> <span class="n">-1</span> <span class="k">if</span> <span class="i">$self</span><span class="i">-&gt;receiveFromServer</span><span class="s">(</span> \<span class="i">*SOCK</span> <span class="s">)</span> != <span class="n">0</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="c">#</span>
    <span class="c"># SMTP AUTH LOGIN type.</span>
    <span class="c">#</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="q">&#39;authtype&#39;</span>} <span class="k">eq</span> <span class="i">$self</span><span class="i">-&gt;AUTHLOGIN</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">return</span> <span class="n">-1</span> <span class="k">if</span> <span class="i">$self</span><span class="i">-&gt;sendToServer</span><span class="s">(</span> \<span class="i">*SOCK</span><span class="cm">,</span> <span class="i">$self</span>-&gt;{<span class="q">&#39;authtype&#39;</span>} <span class="s">)</span><span class="sc">;</span>
        <span class="k">return</span> <span class="n">-1</span> <span class="k">if</span> <span class="i">$self</span><span class="i">-&gt;receiveFromServer</span><span class="s">(</span> \<span class="i">*SOCK</span> <span class="s">)</span> != <span class="n">0</span><span class="sc">;</span>
        <span class="k">return</span> <span class="n">-1</span>
          <span class="k">if</span> <span class="i">$self</span><span class="i">-&gt;sendToServer</span><span class="s">(</span> \<span class="i">*SOCK</span><span class="cm">,</span>
            <span class="i">encode_base64</span><span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="q">&#39;authuserid&#39;</span>}<span class="cm">,</span> <span class="q">&quot;&quot;</span> <span class="s">)</span> <span class="s">)</span> != <span class="n">0</span><span class="sc">;</span>
        <span class="k">return</span> <span class="n">-1</span> <span class="k">if</span> <span class="i">$self</span><span class="i">-&gt;receiveFromServer</span><span class="s">(</span> \<span class="i">*SOCK</span> <span class="s">)</span> != <span class="n">0</span><span class="sc">;</span>
        <span class="k">return</span> <span class="n">-1</span>
          <span class="k">if</span> <span class="i">$self</span><span class="i">-&gt;sendToServer</span><span class="s">(</span> \<span class="i">*SOCK</span><span class="cm">,</span>
            <span class="i">encode_base64</span><span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="q">&#39;authpassword&#39;</span>}<span class="cm">,</span> <span class="q">&quot;&quot;</span> <span class="s">)</span> <span class="s">)</span> != <span class="n">0</span><span class="sc">;</span>
        <span class="k">return</span> <span class="n">-1</span> <span class="k">if</span> <span class="i">$self</span><span class="i">-&gt;receiveFromServer</span><span class="s">(</span> \<span class="i">*SOCK</span> <span class="s">)</span> != <span class="n">0</span><span class="sc">;</span>

    <span class="s">}</span>

    <span class="c">#</span>
    <span class="c"># SMTP AUTH PLAIN type.</span>
    <span class="c">#</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="q">&#39;authtype&#39;</span>} <span class="k">eq</span> <span class="i">$self</span><span class="i">-&gt;AUTHPLAIN</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">return</span> <span class="n">-1</span>
          <span class="k">if</span> <span class="i">$self</span><span class="i">-&gt;sendToServer</span><span class="s">(</span>
            \<span class="i">*SOCK</span><span class="cm">,</span>
            <span class="i">$self</span>-&gt;{<span class="q">&#39;authtype&#39;</span>} . <span class="q">&quot; &quot;</span>
              . <span class="i">encode_base64</span><span class="s">(</span>
                <span class="k">join</span><span class="s">(</span>
                    <span class="q">&quot;\0&quot;</span><span class="cm">,</span> <span class="q">&quot;&quot;</span><span class="cm">,</span> <span class="i">$self</span>-&gt;{<span class="q">&#39;authuserid&#39;</span>}<span class="cm">,</span> <span class="i">$self</span>-&gt;{<span class="q">&#39;authpassword&#39;</span>}
                <span class="s">)</span><span class="cm">,</span>
                <span class="q">&quot;&quot;</span>
              <span class="s">)</span>
          <span class="s">)</span> != <span class="n">0</span><span class="sc">;</span>
        <span class="k">return</span> <span class="n">-1</span> <span class="k">if</span> <span class="i">$self</span><span class="i">-&gt;receiveFromServer</span><span class="s">(</span> \<span class="i">*SOCK</span> <span class="s">)</span> != <span class="n">0</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">return</span> <span class="n">-1</span>
      <span class="k">if</span> <span class="i">$self</span><span class="i">-&gt;sendToServer</span><span class="s">(</span> \<span class="i">*SOCK</span><span class="cm">,</span> <span class="q">&quot;MAIL FROM: &lt;$self-&gt;{&#39;sender&#39;}&gt;&quot;</span> <span class="s">)</span> != <span class="n">0</span><span class="sc">;</span>
    <span class="k">return</span> <span class="n">-1</span> <span class="k">if</span> <span class="i">$self</span><span class="i">-&gt;receiveFromServer</span><span class="s">(</span> \<span class="i">*SOCK</span> <span class="s">)</span> != <span class="n">0</span><span class="sc">;</span>
    <span class="k">for</span> <span class="i">$currEmail</span> <span class="s">(</span> <span class="i">@</span>{<span class="i">$rcptlistRef</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="k">return</span> <span class="n">-1</span>
          <span class="k">if</span> <span class="i">$self</span><span class="i">-&gt;sendToServer</span><span class="s">(</span> \<span class="i">*SOCK</span><span class="cm">,</span> <span class="q">&quot;RCPT TO: &lt;$currEmail&gt;&quot;</span> <span class="s">)</span> != <span class="n">0</span><span class="sc">;</span>
        <span class="k">return</span> <span class="n">-1</span> <span class="k">if</span> <span class="i">$self</span><span class="i">-&gt;receiveFromServer</span><span class="s">(</span> \<span class="i">*SOCK</span> <span class="s">)</span> != <span class="n">0</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">return</span> <span class="n">-1</span> <span class="k">if</span> <span class="i">$self</span><span class="i">-&gt;sendToServer</span><span class="s">(</span> \<span class="i">*SOCK</span><span class="cm">,</span> <span class="q">&quot;DATA&quot;</span> <span class="s">)</span> != <span class="n">0</span><span class="sc">;</span>
    <span class="k">return</span> <span class="n">-1</span> <span class="k">if</span> <span class="i">$self</span><span class="i">-&gt;receiveFromServer</span><span class="s">(</span> \<span class="i">*SOCK</span> <span class="s">)</span> != <span class="n">0</span><span class="sc">;</span>
    <span class="k">return</span> <span class="n">-1</span> <span class="k">if</span> <span class="i">$self</span><span class="i">-&gt;sendToServer</span><span class="s">(</span> \<span class="i">*SOCK</span><span class="cm">,</span> <span class="q">&quot;$self-&gt;{&#39;maildata&#39;}\r\n.&quot;</span> <span class="s">)</span> != <span class="n">0</span><span class="sc">;</span>
    <span class="k">return</span> <span class="n">-1</span> <span class="k">if</span> <span class="i">$self</span><span class="i">-&gt;receiveFromServer</span><span class="s">(</span> \<span class="i">*SOCK</span> <span class="s">)</span> != <span class="n">0</span><span class="sc">;</span>
    <span class="k">return</span> <span class="n">-1</span> <span class="k">if</span> <span class="i">$self</span><span class="i">-&gt;sendToServer</span><span class="s">(</span> \<span class="i">*SOCK</span><span class="cm">,</span> <span class="q">&quot;QUIT&quot;</span> <span class="s">)</span> != <span class="n">0</span><span class="sc">;</span>
    <span class="k">return</span> <span class="n">-1</span> <span class="k">if</span> <span class="i">$self</span><span class="i">-&gt;receiveFromServer</span><span class="s">(</span> \<span class="i">*SOCK</span> <span class="s">)</span> != <span class="n">0</span><span class="sc">;</span>
    <span class="k">eof</span><span class="s">(</span><span class="w">SOCK</span><span class="s">)</span>
      || <span class="k">close</span><span class="s">(</span><span class="w">SOCK</span><span class="s">)</span>
      || <span class="k">return</span> <span class="i">$self</span><span class="i">-&gt;setError</span><span class="s">(</span><span class="q">&quot;Fail close connectiong socket: $!&quot;</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">print</span> <span class="q">&quot;The mail has been sent to &quot;</span> . <span class="k">scalar</span><span class="s">(</span> <span class="i">@</span>{<span class="i">$rcptlistRef</span>} <span class="s">)</span>
      <span class="k">if</span> <span class="i">$self</span>-&gt;{<span class="q">&#39;debugmode&#39;</span>}<span class="sc">;</span>
    <span class="k">print</span> <span class="q">&quot; person/s successfully.\n&quot;</span> <span class="k">if</span> <span class="i">$self</span>-&gt;{<span class="q">&#39;debugmode&#39;</span>}<span class="sc">;</span>

    <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;setAuth($authtype, $userid, $password);</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	This will set the authentication information.</span>
<span class="c">#		$obj-&gt;setAuth($obj-&gt;AUTHLOGIN, $userid, $password);</span>
<span class="c">#		$obj-&gt;setAuth($obj-&gt;AUTHPLAIN, $userid, $password);</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="setAuth-"></a><span class="k">sub </span><span class="m">setAuth ($$$)</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="q">&#39;authtype&#39;</span>}     = <span class="k">shift</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="q">&#39;authuserid&#39;</span>}   = <span class="k">shift</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="q">&#39;authpassword&#39;</span>} = <span class="k">shift</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;sendToServer(\*SOCKET, $message);</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	This will send the message to the SMTP server.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="sendToServer-"></a><span class="k">sub </span><span class="m">sendToServer ($$)</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span>    = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$socket</span><span class="s">)</span>  = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$message</span><span class="s">)</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="k">print</span> <span class="q">&quot;$message\r\n&quot;</span> <span class="k">if</span> <span class="i">$self</span>-&gt;{<span class="q">&#39;debugmode&#39;</span>}<span class="sc">;</span>

    <span class="c"># Fix BareLf problem.</span>
    <span class="i">$message</span> =~ <span class="q">s/\n/\r\n/g</span><span class="sc">;</span>
    <span class="i">$message</span> =~ <span class="q">s/\r\r\n/\r\n/g</span><span class="sc">;</span>

    <span class="c">#</span>
    <span class="c"># Sending data to the server.</span>
    <span class="c">#</span>
    <span class="k">send</span><span class="s">(</span> <span class="i">$socket</span><span class="cm">,</span> <span class="q">&quot;$message\r\n&quot;</span><span class="cm">,</span> <span class="n">0</span> <span class="s">)</span>
      || <span class="k">return</span> <span class="i">$self</span><span class="i">-&gt;setError</span><span class="s">(</span><span class="q">&quot;Fail to send $message: $!&quot;</span><span class="s">)</span><span class="sc">;</span>

    <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;setDebug($obj-&gt;ON);</span>
<span class="c">#		$obj-&gt;setDebug($obj-&gt;OFF);</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	Set the debug mode as ON/OFF.</span>
<span class="c">#		Also see: $obj-&gt;ON and $obj-&gt;OFF methods.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="setDebug-"></a><span class="k">sub </span><span class="m">setDebug ($)</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="q">&#39;debugmode&#39;</span>} = <span class="k">shift</span><span class="sc">;</span>

    <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;setError($errormessage);</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	This will set the error message to &quot;error&quot; attribute in the</span>
<span class="c">#		object and return -1 value.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="setError-"></a><span class="k">sub </span><span class="m">setError ($)</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span>     = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$errorMsg</span><span class="s">)</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="q">&#39;error&#39;</span>} = <span class="i">$errorMsg</span> <span class="k">if</span> <span class="i">$errorMsg</span> !~ <span class="q">/^\s*$/</span><span class="sc">;</span>

    <span class="k">return</span> <span class="n">-1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;setMailBody($mailbody);</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	Set the mail body content.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="setMailBody-"></a><span class="k">sub </span><span class="m">setMailBody ($)</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span>     = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$mailbody</span><span class="s">)</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="q">&#39;mailbody&#39;</span>} = <span class="i">$mailbody</span><span class="sc">;</span>

    <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;setMailHeader($mailheader, $mailheadervalue);</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	This method is used for setting custom email headers.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="setMailHeader-"></a><span class="k">sub </span><span class="m">setMailHeader ($$)</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span>            = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$mailheader</span><span class="s">)</span>      = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$mailheadervalue</span><span class="s">)</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="i">$mailheader</span> =~ <span class="q">tr/[a-z]/[A-Z]/</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="q">&#39;mailheaders&#39;</span>}-&gt;{<span class="q">&#39;OTHERS&#39;</span>}-&gt;{<span class="i">$mailheader</span>} = <span class="i">$mailheadervalue</span><span class="sc">;</span>

    <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;setSMTPPort($smtpport);</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	Set the SMTP port.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="setSMTPPort-"></a><span class="k">sub </span><span class="m">setSMTPPort ($)</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span>     = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$smtpport</span><span class="s">)</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="q">&#39;smtpport&#39;</span>} = <span class="i">$smtpport</span> <span class="k">if</span> <span class="i">$smtpport</span> =~ <span class="q">/^\d+$/</span><span class="sc">;</span>

    <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;setSMTPServer($smtpserver);</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	Set the SMTP server.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="setSMTPServer-"></a><span class="k">sub </span><span class="m">setSMTPServer ($)</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span>       = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$smtpserver</span><span class="s">)</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="i">$smtpserver</span> =~ <span class="q">s/\s*//g</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="q">&#39;smtpserver&#39;</span>} = <span class="i">$smtpserver</span> <span class="k">if</span> <span class="i">$smtpserver</span> !~ <span class="q">/^\s*$/</span><span class="sc">;</span>

    <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># METHOD:	$obj-&gt;version;</span>
<span class="c">#</span>
<span class="c"># DESCRIPTION:	Get the version of the module.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<a name="version-"></a><span class="k">sub </span><span class="m">version ()</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="k">return</span> <span class="i">$VERSION</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#===============================================================================</span>
<span class="c">#</span>
<span class="c"># END of the module.</span>
<span class="c">#</span>
<span class="c">#===============================================================================</span>
<span class="n">1</span><span class="sc">;</span>
<a name="__END__-"></a><span class="k">__END__</span>

</pre><pre><a name="EOF-"></a></pre></body>

</html>
